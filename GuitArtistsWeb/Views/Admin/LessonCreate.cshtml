@{
    ViewData["Title"] = "Адміністративна панель > Створення уроку";
}

@model LessonCreateViewModel
<script src="https://cdn.ckeditor.com/ckeditor5/35.0.0/classic/ckeditor.js"></script>
<link rel="stylesheet" href="~/css/site.css" />
<div class="text-center" style="margin-left: 300px; margin-right: 300px;">
    <h2 style="padding: 20px">Створення уроку</h2>
    <form id="myForm" asp-action="LessonCreate" method="post" enctype="multipart/form-data">
        <div class="form-group">
            <label for="sectionId">Вибір секції</label>
            <select id="sectionId" name="SectionID" class="form-input">
                <option value="">Оберіть секцію</option>
                @foreach (var item in Model.Sections)
                {
                    <option value="@item.Id">@item.Name</option>
                }
                <option value="new">Створити нову секцію</option>
            </select>
        </div>
        <div class="form-group">
            <label for="name">Ім'я</label>
            <input class="form-input" id="name" name="Name"/>
        </div>
        <div class="form-group">
            <label for="appendix">Короткий опис</label>
            <input id="appendix" name="Appendix" class="form-input" />
        </div>
        <div class="form-group">
            <label for="body">Основний текст</label>
            <textarea autocomplete="off" id="body" name="Body" class="form-input wysiwyg-editor" rows="7"></textarea>
        </div>
        <div class="form-group">
            <label for="video">Відео (URL)</label>
            <input id="video" name="Video" class="form-input" />
        </div>
        <div class="form-group">
            <label for="image">Картинка</label>
            <input id="image" name="Image" type="file" class="form-control-file" />
        </div>
        <button type="submit" onclick="addKeyParameter()" class="btn btn-primary">Створити</button>
    </form>

    @if (Model.State != null)
    {
        <p>@Model.State</p>
    }
</div>
<script>
    window.onload = function () {
        var state = @Json.Serialize(Model.State);
        if (state !== null) {
            setTimeout(function () {
                window.location.href = '/Admin/Lessons?key=ваш_ключ_адміністратора';
            }, 1500);
        }
    };
</script>
<script>
    ClassicEditor
        .create(document.querySelector('#body'), {
            ckfinder: {
                uploadUrl: '/uploader/upload/'
            },
            theme: 'dark',
            language: 'uk'
        })
        .catch(error => {
            console.error(error);
        });
</script>
<script>
    document.getElementById('sectionId').addEventListener('change', function () {
        var selectedValue = this.value;
        if (selectedValue === 'new') {
            window.location.href = '/Admin/SectionCreate?key=ваш_ключ_адміністратора';
        }
    });
    function addKeyParameter() {
        var form = document.getElementById("myForm");
        var action = form.getAttribute("action");
        if (action.indexOf('?') === -1) {
            form.setAttribute("action", action + "?key=ваш_ключ_адміністратора");
        } else {
            form.setAttribute("action", action + "&key=ваш_ключ_адміністратора");
        }
    }
</script>
